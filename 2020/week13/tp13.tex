\input{../header.tex}
\usepackage{array}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\begin{document}
% Change the following values to true to show the solutions or/and the hints
\ShowSolutiontrue
\ShowConseiltrue
\titre
\cours{Programmation orientée objet: Héritage et Polymorphisme}

Le but de cette séance est d'approfondir les notions de programmation orientée objet vues précédemment. Les exercices sont construits autour des concepts d'héritage, de surcharge d'opérateurs/méthodes et de polymorphisme. Au terme de cette séance, vous devez être en mesure de factoriser votre code afin de le rendre mieux structuré et plus lisible. Cette série d'exercices est divisée en 4 sections dont une section facultative. À chaque exercice, le langage de programmation à utiliser sera spécifié.

Le code présenté dans les énoncés se trouve sur Moodle, dans le dossier \lstinline{Ressources}.
\section{Rappel: Surcharge des opérateurs - Python}
Dans cette section, vous manipulerez des fractions sous forme d'objets. Vous ferez des opérations de base sur ce nouveau type d'objets.\\

\begin{Exercice}[5 minutes] \textbf{Création de la classe} \\
    Dans un projet que vous aurez au préalable préparé, créez un fichier appelé \lstinline{surcharge.py}.
    À l'intérieur de ce fichier, créer une classe \lstinline{Fraction} qui aura comme attributs privés un numérateur et un dénominateur. 
\end{Exercice}

\begin{Exercice}[5 minutes] \textbf{Constructeur par défaut} \\
Définir un constructeur à votre classe. Assignez des valeurs par défaut à vos attributs. \\
Si un seul argument est passé à votre constructeur, la fraction devra être égale à l'entier correspondant.\\
Empêchez l'utilisateur d'assigner la valeur \lstinline{zéro} au dénominateur.

    \begin{conseil}
		Les valeurs par défaut seront assignées à votre objet au cas où il est instancié sans valeurs. Ainsi en faisant \lstinline{f = Fraction()}, on obtiendra un objet \lstinline{Fraction} ayant pour valeurs un numérateur à 0 et un dénominateur à 1 soit $\frac{0}{1}$.\\
		En Python, vous pouvez donner des valeurs par défaut aux arguments de vos méthodes lors de leur définition. Par exemple, vous pouvez faire: \lstinline{def add(self, x=10, y=5):(...)}.
    \end{conseil}
\end{Exercice}

\begin{Exercice}[5 minutes] \textbf{Type casting}\\
	Convertir les attributs en entier.
	\begin{conseil}
		Pensez à utiliser la fonction \lstinline{int}.
	\end{conseil}
\end{Exercice}

\begin{Exercice}[5 minutes] \textbf{Redéfinition de méthodes} \\
	Rédéfinir la méthode \lstinline{__str__()} pour produire une représentation textuelle de vos objets \lstinline{Fraction}.
	\begin{conseil}
		Une fois la méthode \lstinline{__str()__} redefinie, lorsqu'on fera un \lstinline{print()} sur une instance de votre classe \lstinline{Fraction}, il affichera le message suivant: \textit{Votre fraction a pour valeur \lstinline{numérateur/dénominateur}}. \lstinline{numérateur} et \lstinline{dénominateur} étant les valeurs que vous passerez à votre objet \lstinline{Fraction}.
	\end{conseil}
\end{Exercice}

\begin{Exercice} [5 minutes] \textbf{Accesseurs et mutateurs} \\
	Créer des \lstinline{getters} et \lstinline{setters} pour chacun des attributs de votre classe \lstinline{Fraction}.
\end{Exercice}

\begin{Exercice} [10 minutes] \textbf{Simplification de fractions}\\
	Définir une méthode \lstinline{simplification} qui réduit la \lstinline{Fraction}. Cette méthode ne renverra rien, elle modifiera simplement l'instance. Pour la suite des exercices, assurez-vous de toujours manipuler des fractions simplifiées. Pour ce faire, vous pouvez faire appel à votre méthode \lstinline{simplification} après chaque opération sur un objet de type \lstinline{Fraction}.

	\begin{conseil}
		Afin de simplifier une fraction, vous devez diviser le numérateur et le dénominateur par leur plus grand diviseur commun. Pensez à utiliser la méthode \lstinline{math.gcd} pour trouver le plus grand diviseur commun entre deux nombres.
	\end{conseil}
\end{Exercice}

\begin{Exercice}[15 minutes] \textbf{Redéfinition de méthodes - \_\_eq\_\_}\\
	Redéfinissez la méthode d'instance \lstinline{__eq__} qui prend en entrée un objet \lstinline{Fraction} que vous nommerez \textit{other} (en plus de \lstinline{self}) et qui renvoie \lstinline{True} si \lstinline{self} et l'objet passé en argument ont la même valeur.
	\begin{conseil}
		Pour vérifier l'égalité entre $a/b$ et $c/d$, tester que $a*d$ est égal à $b*c$. \\
		Utilisez la méthode \lstinline{isinstance()} afin de vérifier que \textit{other} est bien de type \lstinline{Fraction}. Dans le cas contraire, affichez un message d'erreur.
		\\La fonction \lstinline{isinstance} prend en entrée une valeur et un type. Elle vérifie que cette valeur est du type défini. Par exemple: \lstinline{isinstance(nombre, int)} renverra \lstinline{True} si la variable \lstinline{nombre} est de type \lstinline{int} et \lstinline{False} dans le cas contraire.
	\end{conseil}
\end{Exercice}

\begin{Exercice}[15 minutes] \textbf{Arithmétique}\\
	Redéfinissez les méthodes \lstinline{__add__} et \lstinline{__mul__} afin d'effectuer des opérations d'addition et de multiplication sur vos objets de type \lstinline{Fraction}. Attention, ces méthodes devront renvoyer des objets de type \lstinline{Fraction}. Dans vos méthodes \lstinline{__add__} et \lstinline{__mul__}, n'oubliez pas de simplifier ces fractions avant de les retourner.\\
	Gérer le cas où l'élément passé en argument n'est ni une \lstinline{Fraction}, ni un \lstinline{int}.
\end{Exercice}


\begin{solution}
	\lstinputlisting{import/surcharge1.py}
\end{solution}
\begin{solution}
	\lstinputlisting{import/surcharge2.py}
\end{solution}

\newpage
\section{Notions d'héritage - Java}


% TODO: Utiliser \lstinline{} sur tous les mots-clés dont les noms d'attributs, classes, méthodes,...

Le but de cette partie est de mettre en pratique les notions liées à l'héritage. Pour cela, nous allons nous inspirer de l'exemple présenté dans le cours. 

Nous allons créer une classe \lstinline{Livre()} qui représentera notre classe mère. Nous allons également créer deux classes filles, \lstinline{Livre_Audio()} et \lstinline{Livre_Illustre()}. Les classes filles hériteront des attributs et méthodes de la classe mère. 

\begin{Exercice}[10 minutes] Création des différentes classes\\
Créez la classe mère \lstinline{Livre()} avec les caractéristiques suivantes:
\begin{itemize}
	\item un attribut \lstinline{privé String} nommé \lstinline{titre},
	\item un attribut \lstinline{privé String} nommé \lstinline{auteur},
	\item un attribut \lstinline{privé int} nommé \lstinline{annee},
	\item un attribut \lstinline{privé int} nommé \lstinline{note} (initialisé à \lstinline{-1}),
	\item le \lstinline{constructeur} de la classe qui prendra les trois premiers arguments cités ci-dessus,
	\item une méthode \lstinline{setNote()} qui permet de définir l'attribut \lstinline{note},
	\item une méthode \lstinline{getNote()} qui permet de retourner l'attribut \lstinline{note},
	\item une méthode \lstinline{toString()} qui retournera le titre, l'auteur, l'année et la note d'un ouvrage \lstinline{note} (réécrire cette méthode permettra d'afficher un objet \lstinline{Livre} en utilisant \lstinline{System.out.println()} \\
\end{itemize}

Attention, si la \lstinline{note} n'a pas été modifiée et qu'elle vaut toujours \lstinline{-1}, affichez "Note : pas encore attribuée" au lieu de "Note : \lstinline{note}" via la méthode \lstinline{toString()}. \\


Créez les classes filles avec les caractéristiques suivantes:\\
\lstinline{class Livre_Audio extends Livre}
\begin{itemize}
	\item un attribut \lstinline{privé String} nommé \lstinline{narrateur}

\end{itemize}
\lstinline{class Livre_Illustre extends Livre}
\begin{itemize}
	\item un attribut \lstinline{privé String} nommé \lstinline{illustrateur}

\end{itemize}

Voici le squelette du code à remplir : \\

\lstinputlisting{ressources/heritage.java}

\begin{conseil}
En java, lors de la déclaration d'une classe, le mot clé \lstinline{extends} permet d'indiquer qu'il s'agit d'une classe fille de la classe indiquée. 

Le mot clé \lstinline{super} permet à la sous classe d'hériter d'éléments de la classe mère. \lstinline{super} peut être utilisé dans le constructeur de la sous-classe selon l'example suivant: \lstinline{super(attribut_mère_1, attribut_mère_2, attribut_mère_3, etc.);}. Ainsi, il n'est pas nécessaire de redéfinir tous les attributs d'une classe fille !

L'instruction \lstinline{super} doit toujours être la première instruction dans le constructeur d'une sous-classe.

Vous pouvez vous servir de \lstinline{\n} dans une chaine de caractères pour effectuer un retour à la ligne lors de l'affichage.
\end{conseil}

\begin{solution}
	\lstinputlisting{Solutions/heritage-solution-1.java}
\end{solution}

\end{Exercice}

\begin{Exercice}[5 minutes] Méthode et héritage \\

Maintenant que vous avez créé la classe et les classes filles correspondantes, vous pouvez créer un objet \lstinline{Livre} à l'aide du constructeur de la classe \lstinline{Livre_Audio} (et des arguments donnés lors de la création de l'objet).

% TODO: Phrase à reformuler. S'agit-il de valeurs par défaut du constructeur ou des valeurs de l'instance?

Si vous manquez d'inspiration vous pouvez indiquer les valeurs suivantes : titre: "Hamlet", auteur: "Shakespeare", année: "1609" et le narrateur "William.\\

Une fois l'objet créé, attribuez lui une note à l'aide de la méthode \lstinline{setNote()} définie précédemment.\\ 

Finalement, utilisez la méthode \lstinline{System.out.println()} pour afficher les informations du livre.\\

La méthode étant définie dans la classe mère, elle n'a pas connaissance de la variable \lstinline{narrateur} définie dans la sous-classe. Redéfinissez la méthode dans la classe fille pour y inclure l'information sur le narrateur. \\

Faites pareil avec la classe \lstinline{Livre_Illustre} et son attribut \lstinline{Illustrateur}

\begin{conseil}
\textbf{Attention}, on vous demande de créer un objet \lstinline{Livre} et non pas \lstinline{Livre_Audio}.

Le mot clef \lstinline{super} peut être utilisé dans la redéfinition d'une méthode selon l'exemple suivant: \lstinline{super.nom_de_la_methode();}. Le mot clé \lstinline{super} représente la classe parent, tout comme le mot clé \lstinline{this} représentait l'instance avec laquelle la méthode été appelée. Appeler la méthode via le mot clé \lstinline{super} effectuera et renverra ce que la méthode de la classe mère effectue et renvoie.


L'instruction \lstinline{super} doit toujours être la première instruction dans le redéfinition d'une méthode dans une classe fille. 
\end{conseil}

\begin{solution}
	\lstinputlisting{Solutions/heritage-solution-2.java}
	\lstinputlisting{Solutions/heritage-solution-3.java}
\end{solution}

\end{Exercice}

Lorsque toutes les étapes auront été effectuées, effectuez ce \lstinline{main} : \\

\lstinputlisting{ressources/heritage_main.java}


Vous devriez obtenir : \\


\lstinputlisting{ressources/Heritage_main_prompt.java}

\section{Polymorphisme - Java}
% TODO: Utiliser \lstinline{} sur tous les mots-clés dont les noms d'attributs, classes, méthodes,... Par exemple sur Soigneur-

Dans cette partie, vous serez amenés à créer 2 nouvelles sous-classes de la classe mère \lstinline{Fighter}. La première classe représentera un \lstinline{Soigneur}, qui, lorsqu'il attaquera quelqu'un, le soignera au lieu de le blesser. La deuxième classe représentera un combattant spécialisé dans l'attaque \lstinline{Attaquant}, qui aura la capacité d'attaquer un certain nombre de fois (ce nombre sera défini au moment où vous l'instancierez). Pensez à télécharger la dernière version de la classe \lstinline{Fighter} dans le dossier ressources.\\

Voici le squelette du code que vous trouverez également dans le dossier ressources du moodle : \\

\lstinputlisting{ressources/Combattant_squelette.java}

\begin{Exercice}[5 minutes] Sous-classe \lstinline{Soigneur} \\

Commencez par déclarer une nouvelle sous-classe \lstinline{Soigneur}. Cette sous-classe prendra un nouvel attribut \lstinline{private}, \lstinline{int}, nommé \lstinline{résurrection}, qui vaudra 1 lors de l'instanciation. \\

Déclarez le \lstinline{constructeur} de cette classe ainsi que les \lstinline{getter} et \lstinline{setter} permettant d'interagir avec ce nouvel attribut (\lstinline{résurrection}). \\

\begin{conseil}
Pensez à utiliser le constructeur de votre classe mère \lstinline{Fighter}
\end{conseil}

\begin{solution}
	\lstinputlisting{Solutions/Soigneur.java}
\end{solution}

\end{Exercice}

\begin{Exercice}[10 minutes] Méthode \lstinline{résurrection(Fighter other)} de la sous-classe \lstinline{Soigneur} \\

Commencez par déclarer une nouvelle méthode nommée \lstinline{résurrection(Fighter other)}. \\
Cette méthode permettra de faire revenir un \lstinline{Fighter} à la vie, mais le \lstinline{Soigneur} ne pourra le faire qu'une seule fois. \\

Commencez par contrôler que l'instance depuis laquelle la méthode est appelée soit toujours en vie. Si ce n'est pas le cas, indiquez : \lstinline{nom_instance} est mort et ne peut plus rien faire.  \\ 

Contrôlez ensuite que l'instance \lstinline{other} soit vraiment morte. Si ce n'est pas le cas, indiquez le via : \lstinline{nom_other} est toujours en vie. \\

Pour finir, contrôlez que l'attribut \lstinline{résurrection} de l'instance depuis laquelle la méthode est appelée est égale à 1. Si ce n'est pas le cas, indiquez : \lstinline{nom_instance} ne peut plus ressusciter personne.\\

Si tous ces éléments sont réunis, faites revenir le \lstinline{Fighter} \lstinline{other} à la vie en lui remettant 10 points de vie et en l'ajoutant à la liste \lstinline{instances} de la classe \lstinline{Fighter}. Pensez également à mettre l'attribut \lstinline{résurrection} de l'instance appelée à   
0 afin de l'empêcher de réutiliser ce pouvoir, à appeler la méthode \lstinline{checkHealth()}, et à indiquer : \lstinline{nom_other} est revenu à la vie ! \\

\begin{conseil}
Utilisez un branchement conditionnel pour les contrôles. \\

Une nouvelle méthode nommée \lstinline{addInstances(Fighter other)} a été créée dans la classe \lstinline{Fighter}. Regardez à quoi elle sert et utilisez la. \\

Pour les indications en fonction des différentes conditions, imprimmez simplement la phrase en question. \\
\end{conseil}

\begin{solution}
	\lstinputlisting{Solutions/resurrection.java}
\end{solution}

\end{Exercice}

\begin{Exercice}[10 minutes] Méthode attack de la sous-classe \lstinline{Soigneur} \\

Réécrivez la méthode \lstinline{attack} de la sous-classe \lstinline{Soigneur} afin d'ajouter des points de vie à \lstinline{other} au lieu de lui en retirer. \\

Le seul argument nécessaire pour cette méthode sera le \lstinline{Fighter} \lstinline{other}. \\

Commencez par contrôler que le \lstinline{Soigneur} depuis lequel la méthode est appelée est encore en vie. Si ce n'est pas le cas, indiquez : \lstinline{nom_instance} est mort et ne peut plus rien faire.

Contrôlez ensuite si \lstinline{other} est toujours en vie. Si ce n'est pas le cas indiquez : \lstinline{nom_other} est déjà mort, ressuscitez le afin de pouvoir le soigner. Contrôlez également qu'il ait moins de 10 points de vie. Si ce n'est pas le cas, indiquez le via : \lstinline{nom_other} a déjà le maximum de points de vie. \\

Si toutes ces conditions sont réunies, ajoutez la valeur de l'attaque de l'instance qui appelle la méthode aux points de vie de \lstinline{other}, puis appelez la méthode de classe \lstinline{checkHealth()}.

\begin{conseil}
Pensez à utiliser du branchement conditionnel pour les contrôles. \\

Le nombre de points de vie à ajouter est simplement égal à l'attaque de l'instance depuis laquelle la méthode est appelée. Ajoutez la valeur de cet attribut \lstinline{attack} au \lstinline{Fighter} \lstinline{other}

\end{conseil}

\begin{solution}
	\lstinputlisting{Solutions/Soigneur_attack.java}
\end{solution}

\end{Exercice}

\begin{Exercice}[5 minutes] Sous-classe \lstinline{Attaquant} \\

Commencez par déclarer une nouvelle sous-classe \lstinline{Attaquant}. Cette sous-classe prendra un nouvel attribut \lstinline{private}, \lstinline{int}, nommé \lstinline{multiplicateur}, qui sera passé en argument du \lstinline{constructeur} de la sous-classe. \\

Déclarez le \lstinline{constructeur} de cette classe ainsi que les \lstinline{getter} et \lstinline{setter} permettant d'interagir avec ce nouvel attribut \lstinline{multiplicateur}. \\

\begin{conseil}
Pensez à utiliser le \lstinline{constructeur} de votre classe mère \lstinline{Combattant}.
\end{conseil}

\begin{solution}
	\lstinputlisting{Solutions/Attaquant.java}
\end{solution}

\end{Exercice}

\begin{Exercice}[10 minutes] Méthode \lstinline{attack} de la sous-classe \lstinline{Attaquant} \\

Réécrivez la méthode \lstinline{attack} de la sous-classe \lstinline{Attaquant} afin d'effectuer plusieurs attaques sur \lstinline{other} en fonction de l'attribut \lstinline{multiplicateur}. \\

Y'a t-il besoin de contrôler si l'instance depuis laquelle la méthode est appelée est encore en vie ? \\

Indiquez systématiquement le numéro de l'attaque, puis effectuez l'attaque. Répétez le procédé jusqu'à ce que le numéro de l'attaque soit égal à celui de \lstinline{multiplicateur_instance}.

\begin{conseil}
Aidez vous de la méthode \lstinline{attack} de la classe mère \lstinline{Combattant}.\\

Comment peut-on effectuer plusieurs fois une même séquence d'action en programmation ? \\

\end{conseil}

\begin{solution}
	\lstinputlisting{Solutions/Attaquant_attack.java}
\end{solution}

\end{Exercice}

Si tout est correct, en utilisant ce \lstinline{main} : \\

\lstinputlisting{ressources/Combattant_main.java} 

Vous devriez obtenir : \\

\lstinputlisting{Solutions/Combattant_main_solution.java} 

\section{Héritage en Python \optionnel}
% Python
% TODO: Attention, les décorateurs ne sont pas présentés en cours!
% Utiliser \lstinline{} sur tous les mots-clés (nom de classes, d'attributs, méthodes,...)
% Faire des exercices en français. Remplacer les noms de méthodes et attributs par des mots français qui puissent parler aux étudiants.

\begin{Exercice}[10 minutes]\textbf{Classe Point (Suite)}

Dans la série dernière, vous avez rencontré un exemple de classe en Python. Celui-là représente un point de 2 dimensions, x et y, ainsi que des calculs basiques des points 2D. Pour cet exercice, vous allez implémenter une classe des points de 3 dimensions en utilisant de l'héritage sur la classe \textbf{Point} qu'on a implémentée! À travers cet exercice, nous voudrions également vous présenter une syntaxe en Python qui concerne l'utilisation des 'décorateurs'.\\


Avant de commencer, nous voudrions attirer votre attentions sur les points suivants de la classe mère Point:
\begin{itemize}
    \item Tout d'abord, nous avons récrit la classe de la semaine dernière pour utiliser les 'decorators' en Python. Par exemple, vous trouverez une explication \href{https://python-reference.readthedocs.io/en/latest/docs/property/setter.html}{\textcolor{cyan}{ici}} pour le décorateur \textbf{setter}. Lisez bien les documentations et le code suivant pour comprendre l'usage de ces décorateurs.
    \item Nous avons changé le nom de la méthode \textbf{distance()} pour \textbf{euclidean\_distance()} pour la distinguer des autres types de distance. 
    \item Traiter la classe \textbf{Point} comme mère et faire l'hériter depuis la classe \textbf{Point3D} n'est pas la meilleure structure d'un programme Python, mais on la garde pour le moment afin de vous montrer comment les méthodes de classe mère peuvent être manipulées dans une classe fille.
\end{itemize}

Voici la classe \textbf{Point} qui était légèrement modifiée:
\lstinputlisting{ressources/Point.py} 

Ecrivez une classe qui hérite \textbf{Point}. Nommez-la \textbf{Point3D}. Après avoir rajouté la 3ème dimension comme attribut, implémentez les opérations ci-dessous:

\begin{itemize}
    \item Rajoutez une méthode qui renvoie une représentation vectorielle du point. Vous pouvez utiliser la \textbf{liste} en Python.
    \item Recalculez la distance euclidean et le milieu pour le point 3D.
	\item (Optionnel) Si vous voulez vous familiariser encore plus avec les méthodes de classe en Python, implémentez deux autres calculs de distance: Manhattan et Minkowski (détails : \url{https://www.analyticsvidhya.com/blog/2020/02/4-types-of-distance-metrics-in-machine-learning/} - % TODO: Remplacer par les articles Wikipédia correspondants
	)
\end{itemize}
\lstinputlisting{ressources/Point3D.py} 

\begin{conseil}
Recherchez sur Internet des documentations sur les décorateurs Python, notamment sur 'property', 'setter' et 'getter'. 

Que fait \textbf{super.\_\_init\_\_()}?

Vous voudrez aussi vous demander si la représentation vectorielle d'un point pourrait être une propriété au lieu d'une méthode. 
\end{conseil}
\begin{solution}
\lstinputlisting{Solutions/Point3D.py} 
\end{solution}
\end{Exercice} 

\begin{Exercice}[15 minutes]\textbf{Un exemple appliqué}

Dans les établissements universitaires, on rencontre souvent des problèmes lors du calcul de salaires du personnel. Sans penser aux recherches effectuées par certains professeurs, on va essayer de calculer les salaires de ceux qui sont reconnus comme 'Professor' à l'université et ceux qui y donnent des cours à temps partiel ('Part-time Lecturer').

La classe mère dans ce cas est nommée \textbf{Lecturer}, qui possède une propriété - le salaire annuel moyen. On voudrais que la méthode qui calcule cette quantité renvoie 60 000 (dollars américains) si l'enseignant a moins de 10 ans d'expériences, et 100 000 sinon. Si l'enseignant travaille à temps partiel, la méthode devrait renvoyer une chaîne qui dit 'Salary for part-time lecturers unknown'.

Ensuite, on veut calculer la paye mensuelle pour chaque type d'employé. Pour les 'Professors', la paye devrait être calculée sur la base de deux sources de revenu: un salaire mensuel et une commission pour chaque comité où ils participent. 

D'autre part, pour les 'Part-time Lecturers', la paye est calculée sur une base horaire i.e taux horaire $\times$ nombres d'heures de travail (par mois).
\lstinputlisting{ressources/Lecturer.py} 

\begin{conseil}
Où devrait-on mettre \textbf{super.\_\_init\_\_()} dans cet exemple ?

De nouveau, réfléchissez bien si quelques méthodes peuvent être traitées comme 'propriétés'.
\end{conseil}

\begin{solution}
\lstinputlisting{Solutions/Lecturer.py} 
\end{solution}
\end{Exercice}

\end{document}
